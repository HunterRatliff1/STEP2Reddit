MostRecent = last(PHQ9_score),
Delta      = MostRecent - Baseline) %>%
filter(nResponses>1) %>%
View()
PHQ_overview <- PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
nResponses = n(),    # find the total number of responses per user
Baseline   = first(PHQ9_score),
MostRecent = last(PHQ9_score),
Delta      = MostRecent - Baseline) %>%
ungroup()
summary(PHQ_overview$Baseline)
PHQ_overview %>%
ggplot(aes(x=Baseline)) + geom_histogram()
PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
Base.score  = first(PHQ9_score),
Base.acuity = first(acuity)
) %>%
ungroup()
PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
Base.score  = first(PHQ9_score),
Base.acuity = first(PHQ9_acuity)
) %>%
ungroup()
ggplot(aes(x=Base.score, fill=Base.acuity)) + geom_histogram()
PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
Base.score  = first(PHQ9_score),
Base.acuity = first(PHQ9_acuity)
) %>%
ggplot(aes(x=Base.score, fill=Base.acuity)) + geom_histogram()
PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
Base.score  = first(PHQ9_score),
Base.acuity = first(PHQ9_acuity)
) %>%
ggplot(aes(x=Base.score, fill=Base.acuity)) +
geom_histogram() +
scale_fill_brewer() +
labs(x="Baseline PHQ9 score")
PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
Base.score  = first(PHQ9_score),
Base.acuity = first(PHQ9_acuity)
) %>%
mutate(Base.acuity = as.factor(Base.acuity)) %>%
ggplot(aes(x=Base.score, fill=Base.acuity)) +
geom_histogram() +
scale_fill_brewer() +
labs(x="Baseline PHQ9 score")
PHQ$PHQ9_acuity %>% unique()
PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
Base.score  = first(PHQ9_score),
Base.acuity = as.factor(first(PHQ9_acuity), ordered=T,
levels=c("none", "mild", "moderate",
"moderately severe", "severe"))
) %>%
mutate(Base.acuity = as.factor(Base.acuity)) %>%
ggplot(aes(x=Base.score, fill=Base.acuity)) +
geom_histogram() +
scale_fill_brewer() +
labs(x="Baseline PHQ9 score")
PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
Base.score  = first(PHQ9_score),
Base.acuity = as.factor(first(PHQ9_acuity), ordered=T,
levels=c("none", "mild", "moderate",
"moderately severe", "severe"))
) %>%
# mutate(Base.acuity = as.factor(Base.acuity)) %>%
ggplot(aes(x=Base.score, fill=Base.acuity)) +
geom_histogram() +
scale_fill_brewer() +
labs(x="Baseline PHQ9 score")
PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
Base.score  = first(PHQ9_score),
Base.acuity = first(PHQ9_acuity)
) %>%
mutate(Base.acuity = as.factor(Base.acuity, ordered=T,
levels=c("none", "mild", "moderate",
"moderately severe", "severe"))) %>%
ggplot(aes(x=Base.score, fill=Base.acuity)) +
geom_histogram() +
scale_fill_brewer() +
labs(x="Baseline PHQ9 score")
PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
Base.score  = first(PHQ9_score),
Base.acuity = first(PHQ9_acuity)
) %>%
mutate(Base.acuity = as.factor(Base.acuity, ordered=T,
levels=c("none", "mild", "moderate",
"moderately severe", "severe"))) %>%
ggplot(aes(x=Base.score, fill=Base.acuity)) +
geom_histogram() +
scale_fill_brewer() +
labs(x="Baseline PHQ9 score")
PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
Base.score  = first(PHQ9_score),
Base.acuity = first(PHQ9_acuity)
) %>%
mutate(Base.acuity = factor(Base.acuity, ordered=T,
levels=c("none", "mild", "moderate",
"moderately severe", "severe"))) %>%
ggplot(aes(x=Base.score, fill=Base.acuity)) +
geom_histogram() +
scale_fill_brewer() +
labs(x="Baseline PHQ9 score")
PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
Base.score  = first(PHQ9_score),
Base.acuity = first(PHQ9_acuity)
) %>%
mutate(Base.acuity = factor(Base.acuity, ordered=T,
levels=c("none", "mild", "moderate",
"moderately severe", "severe"))) %>%
ggplot(aes(x=Base.score, fill=Base.acuity)) +
geom_histogram() +
scale_fill_continuous_tableau() +
labs(x="Baseline PHQ9 score")
PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
Base.score  = first(PHQ9_score),
Base.acuity = first(PHQ9_acuity)
) %>%
mutate(Base.acuity = factor(Base.acuity, ordered=T,
levels=c("none", "mild", "moderate",
"moderately severe", "severe"))) %>%
ggplot(aes(x=Base.score, fill=Base.acuity)) +
geom_histogram() +
# scale_fill_continuous_tableau() +
labs(x="Baseline PHQ9 score")
PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
Base.score  = first(PHQ9_score),
Base.acuity = first(PHQ9_acuity)
) %>%
mutate(Base.acuity = factor(Base.acuity, ordered=T,
levels=c("none", "mild", "moderate",
"moderately severe", "severe"))) %>%
ggplot(aes(x=Base.score, fill=Base.acuity)) +
geom_histogram() +
scale_fill_brewer(palette = 2) +
labs(x="Baseline PHQ9 score")
PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
Base.score  = first(PHQ9_score),
Base.acuity = first(PHQ9_acuity)
) %>%
mutate(Base.acuity = factor(Base.acuity, ordered=T,
levels=c("none", "mild", "moderate",
"moderately severe", "severe"))) %>%
ggplot(aes(x=Base.score, fill=Base.acuity)) +
geom_histogram() +
scale_fill_brewer(palette = 3) +
labs(x="Baseline PHQ9 score")
PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
Base.score  = first(PHQ9_score),
Base.acuity = first(PHQ9_acuity)
) %>%
mutate(Base.acuity = factor(Base.acuity, ordered=T,
levels=c("none", "mild", "moderate",
"moderately severe", "severe"))) %>%
ggplot(aes(x=Base.score, fill=Base.acuity)) +
geom_histogram() +
scale_fill_brewer(palette = 4) +
labs(x="Baseline PHQ9 score")
PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
Base.score  = first(PHQ9_score),
Base.acuity = first(PHQ9_acuity)
) %>%
mutate(Base.acuity = factor(Base.acuity, ordered=T,
levels=c("none", "mild", "moderate",
"moderately severe", "severe"))) %>%
ggplot(aes(x=Base.score, fill=Base.acuity)) +
geom_histogram() +
scale_fill_brewer(palette = 5) +
labs(x="Baseline PHQ9 score")
RColorBrewer::brewer.pal()
PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
Base.score  = first(PHQ9_score),
Base.acuity = first(PHQ9_acuity)
) %>%
mutate(Base.acuity = factor(Base.acuity, ordered=T,
levels=c("none", "mild", "moderate",
"moderately severe", "severe"))) %>%
ggplot(aes(x=Base.score, fill=Base.acuity)) +
geom_histogram() +
scale_fill_brewer(palette = "Reds") +
labs(x="Baseline PHQ9 score")
PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
Base.score  = first(PHQ9_score),
Base.acuity = first(PHQ9_acuity)
) %>%
mutate(Base.acuity = factor(Base.acuity, ordered=T,
levels=c("none", "mild", "moderate",
"moderately severe", "severe"))) %>%
ggplot(aes(x=Base.score, fill=Base.acuity)) +
geom_histogram(color="black") +
scale_fill_brewer(palette = "Reds") +
labs(x="Baseline PHQ9 score")
PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
Base.score  = first(PHQ9_score),
Base.acuity = first(PHQ9_acuity)
) %>%
mutate(Base.acuity = factor(Base.acuity, ordered=T,
levels=c("none", "mild", "moderate",
"moderately severe", "severe"))) %>%
ggplot(aes(x=Base.score, fill=Base.acuity)) +
geom_histogram(color="black") +
scale_fill_brewer(palette = "Reds", label="") +
labs(x="Baseline PHQ9 score", y="# of members", title="Baseline PHQ9 scores")
PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
Base.score  = first(PHQ9_score),
Base.acuity = first(PHQ9_acuity)
) %>%
mutate(Base.acuity = factor(Base.acuity, ordered=T,
levels=c("none", "mild", "moderate",
"moderately severe", "severe"))) %>%
ggplot(aes(x=Base.score, fill=Base.acuity)) +
geom_histogram(color="black") +
scale_fill_brewer(palette = "Reds", title="") +
labs(x="Baseline PHQ9 score", y="# of members", title="Baseline PHQ9 scores")
PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
Base.score  = first(PHQ9_score),
Base.acuity = first(PHQ9_acuity)
) %>%
mutate(Base.acuity = factor(Base.acuity, ordered=T,
levels=c("none", "mild", "moderate",
"moderately severe", "severe"))) %>%
ggplot(aes(x=Base.score, fill=Base.acuity)) +
geom_histogram(color="black") +
scale_fill_brewer(palette = "Reds", title="") +
labs(x="Baseline PHQ9 score", y="# of members", title="Baseline PHQ9 scores",
fill="Baseline acuity")
PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
Base.score  = first(PHQ9_score),
Base.acuity = first(PHQ9_acuity)
) %>%
mutate(Base.acuity = factor(Base.acuity, ordered=T,
levels=c("none", "mild", "moderate",
"moderately severe", "severe"))) %>%
ggplot(aes(x=Base.score, fill=Base.acuity)) +
geom_histogram(color="black") +
scale_fill_brewer(palette = "Reds") +
labs(x="Baseline PHQ9 score", y="# of members", title="Baseline PHQ9 scores",
fill="Baseline acuity")
SDS %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
nResponses = n(),    # find the total number of responses per user
Base.score   = first(SDS_days_unproductive),
Recent.score = last(SDS_days_unproductive),
Delta.score  = Recent.score - Base.score) %>%
ungroup()
SDS_productivity <- SDS %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
nResponses = n(),    # find the total number of responses per user
Base.score   = as.numeric(first(SDS_days_unproductive)),
Recent.score = as.numeric(last(SDS_days_unproductive)),
Delta.score  = Recent.score - Base.score) %>%
ungroup()
View(SDS_productivity)
View(masterDf)
SDS %>%
filter(mid=="1c3f48e629a99ca2a05d4f38692409cc3b5e778ff9a49c3563c15353e56fc37b")
SDS %>%
filter(mid=="1c3f48e629a99ca2a05d4f38692409cc3b5e778ff9a49c3563c15353e56fc37b")
SDS %>%
filter(mid=="1c3f48e629a99ca2a05d4f38692409cc3b5e778ff9a49c3563c15353e56fc37b") %>%
select(asmt_time, begins_with("SDS"))
SDS %>%
filter(mid=="1c3f48e629a99ca2a05d4f38692409cc3b5e778ff9a49c3563c15353e56fc37b") %>%
select(asmt_time, starts_with("SDS"))
SDS %>%
filter(mid=="1c3f48e629a99ca2a05d4f38692409cc3b5e778ff9a49c3563c15353e56fc37b") %>%
select(asmt_time, starts_with("SDS"))
SDS %>%
arrange(qst_time) %>%
filter(mid=="1c3f48e629a99ca2a05d4f38692409cc3b5e778ff9a49c3563c15353e56fc37b") %>%
select(asmt_time, starts_with("SDS")) %>%
knitr::kable()
SDS %>%
arrange(qst_time) %>%
filter(mid=="1c3f48e629a99ca2a05d4f38692409cc3b5e778ff9a49c3563c15353e56fc37b") %>%
select(asmt_time, starts_with("SDS")) %>%
knitr::kable()
SDS_productivity <- SDS %>%
filter(!is.na(SDS_days_unproductive)) %>% # ADD THIS LINE
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
nResponses = n(),
Base.score   = first(SDS_days_unproductive),
Recent.score = last(SDS_days_unproductive),
Delta.score  = Recent.score - Base.score) %>%
ungroup()
SDS %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
nResponses = n(),
Base.score   = first(SDS_days_unproductive),
Recent.score = last(SDS_days_unproductive),
Delta.score  = Recent.score - Base.score) %>%
ungroup()
SDS %>%
filter(!is.na(SDS_days_unproductive)) %>% # ADD THIS LINE
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
nResponses = n(),
Base.score   = first(SDS_days_unproductive),
Recent.score = last(SDS_days_unproductive),
Delta.score  = Recent.score - Base.score) %>%
ungroup()
nResponses = n(),
nResponses = n(),
SDS_productivity <- SDS %>%
filter(!is.na(SDS_days_unproductive)) %>% # ADD THIS LINE
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
nResponses = n(),
Base.score   = first(SDS_days_unproductive),
Recent.score = last(SDS_days_unproductive),
Delta.score  = Recent.score - Base.score) %>%
ungroup()
mean(SDS_productivity$Delta.score)
cor.test(formula = ~ PHQ_overview$Delta.score + SDS_productivity$Delta.score)
View(SDS_productivity)
PHQ_overview <- PHQ %>%
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
nResponses = n(),    # find the total number of responses per user
Base.score   = first(PHQ9_score),
Recent.score = last(PHQ9_score),
Delta.score  = Recent.score - Base.score) %>%
ungroup()
cor.test(x=PHQ_overview$Delta.score, y=SDS_productivity$Delta.score)
nrow(PHQ_overview)
nrow(SDS_productivity)
abbreviate("unproductive")
abbreviate("unproductive", 6)
abbreviate("unproductive", 5)
knitr::opts_chunk$set(collapse = TRUE, warning=FALSE, message=F, tidy=TRUE)
suppressPackageStartupMessages(require(tidyverse))
suppressPackageStartupMessages(require(ggthemes))
suppressPackageStartupMessages(require(lubridate))
suppressPackageStartupMessages(require(stringr))
# Might just be a problem on my system, but I have to run this code
# to set the timezone so lubridate will work
Sys.setenv(TZ="America/Chicago")
rm(PHQ_overview)
rm(SDS_productivity)
# Remake the PHQ9 score df
PHQ_score <- PHQ %>%
filter(!is.na(PHQ9_score)) %>% # Just to be consistent
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
PHQ.n      = n(),
PHQ.base   = first(SDS_days_unproductive),
PHQ.recent = last(SDS_days_unproductive),
PHQ.Delta  = PHQ.recent - PHQ.base) %>%
ungroup()
# Remake the SDS - Productivity df
unprdDays <- SDS %>%
filter(!is.na(SDS_days_unproductive)) %>% # This is the line I added
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
unprdDays.n      = n(),
unprdDays.base   = first(SDS_days_unproductive),
unprdDays.recent = last(SDS_days_unproductive),
unprdDays.Delta  = unprdDays.recent - unprdDays.base) %>%
ungroup()
View(PHQ)
View(PHQ_score)
rm(PHQ_overview)
rm(SDS_productivity)
# Remake the PHQ9 score df
PHQ_score <- PHQ %>%
filter(!is.na(PHQ9_score)) %>% # Just to be consistent
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
PHQ.n      = n(),
PHQ.base   = first(PHQ9_score),
PHQ.recent = last(PHQ9_score),
PHQ.Delta  = PHQ.recent - PHQ.base) %>%
ungroup()
# Remake the SDS - Productivity df
unprdDays <- SDS %>%
filter(!is.na(SDS_days_unproductive)) %>% # This is the line I added
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
unprdDays.n      = n(),
unprdDays.base   = first(SDS_days_unproductive),
unprdDays.recent = last(SDS_days_unproductive),
unprdDays.Delta  = unprdDays.recent - unprdDays.base) %>%
ungroup()
View(PHQ_score)
PHQ_score %>% filter(PHQ.n>1)
PHQ_score <- PHQ_score %>% filter(PHQ.n>1)
PHQ.n      = n(),
PHQ_score <- PHQ %>%
filter(!is.na(PHQ9_score)) %>% # Just to be consistent
group_by(mid) %>%
arrange(qst_time) %>%
summarise(
PHQ.n      = n(),
PHQ.base   = first(PHQ9_score),
PHQ.recent = last(PHQ9_score),
PHQ.Delta  = PHQ.recent - PHQ.base) %>%
ungroup()
PHQ_score <- PHQ_score %>% filter(PHQ.n>1)
unprdDays <- unprdDays %>% filter(unprdDays.n>1)
full_join(PHQ_score, unprdDays) %>% nrow()
inner_join(PHQ_score, unprdDays) %>% nrow()
joinedDf <- inner_join(PHQ_score, unprdDays)
View(joinedDf)
names(joinedDf)
cor.test(~PHQ.Delta + unprdDays.Delta, data=joinedDf)
joinedDf %>% ggplot(aes(x=PHQ.Delta, y=unprdDays.Delta)) + geom_point()
joinedDf %>%
ggplot(aes(x=PHQ.Delta, y=unprdDays.Delta)) +
geom_jitter(alpha=0.7)
joinedDf %>%
ggplot(aes(x=PHQ.Delta, y=unprdDays.Delta)) +
geom_jitter(alpha=0.3)
joinedDf %>%
ggplot(aes(x=PHQ.Delta, y=unprdDays.Delta)) +
geom_jitter(alpha=0.3) +
geom_smooth()
joinedDf %>%
ggplot(aes(x=PHQ.Delta, y=unprdDays.Delta)) +
geom_jitter(alpha=0.3) +
geom_smooth()
joinedDf %>%
ggplot(aes(x=PHQ.Delta, y=unprdDays.Delta)) +
geom_jitter(alpha=0.3) +
geom_smooth(method=lm)
joinedDf %>%
ggplot(aes(x=PHQ.Delta, y=unprdDays.Delta)) +
geom_jitter(alpha=0.3) +
geom_smooth(method=lm)
glimpse(masterDf)
